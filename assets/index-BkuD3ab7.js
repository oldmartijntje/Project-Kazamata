var B=Object.defineProperty;var G=(i,t,e)=>t in i?B(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var T=(i,t,e)=>(G(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();class r{constructor(t=0,e=0){this.x=t,this.y=e}duplicate(){return new r(this.x,this.y)}}class X{constructor(t,e){T(this,"mainLoop",t=>{if(!this.isRunning)return;let e=t-this.lastFrameTime;for(this.lastFrameTime=t,this.accumulatedTime+=e;this.accumulatedTime>=this.timeStep;)this.update(this.timeStep),this.accumulatedTime-=this.timeStep;this.render(),this.rafId=requestAnimationFrame(this.mainLoop)});this.lastFrameTime=0,this.accumulatedTime=0,this.timeStep=1e3/60,this.update=t,this.render=e,this.rafId=null,this.isRunning=!1}start(){this.isRunning||(this.isRunning=!0,this.rafId=requestAnimationFrame(this.mainLoop))}stop(){this.rafId||cancelAnimationFrame(this.rafId),this.isRunning=!1}}class j{constructor(){T(this,"callbacks",[]);T(this,"nextId",0)}emit(t,e){this.callbacks.forEach(s=>{s.eventName===t&&s.callback(e)})}on(t,e,s){return this.nextId++,this.callbacks.push({id:this.nextId,eventName:t,caller:e,callback:s}),this.nextId}off(t){this.callbacks=this.callbacks.filter(e=>e.id!==t)}unsubscribe(t){this.callbacks=this.callbacks.filter(e=>e.caller!==t)}}const m=new j;class w{constructor({position:t}){this.position=t??new r(0,0),this.children=[],this.parent=null,this.hasBeenInitiated=!1,this.isSolid=!1,this.drawLayer=null}stepEntry(t,e){this.children.forEach(s=>s.stepEntry(t,e)),this.hasBeenInitiated||(this.hasBeenInitiated=!0,this.onInit()),this.step(t,e)}onInit(){}step(t){}draw(t,e,s){const n=e+this.position.x,o=s+this.position.y;this.drawImage(t,n,o),this.getDrawChildrenOrdered().forEach(a=>a.draw(t,n,o))}getDrawChildrenOrdered(){return[...this.children].sort((t,e)=>e.drawLayer==="FLOOR"||t.position.y>e.position.y?1:-1)}drawImage(t,e,s){}destroy(){this.children.forEach(t=>t.destroy()),this.parent&&this.parent.removeChild(this)}addChild(t){t.parent=this,this.children.push(t)}removeChild(t){m.unsubscribe(t),this.children=this.children.filter(e=>e!==t)}}class Y extends w{constructor(){super({}),this.offset=new r(0,0),this.onInit()}onInit(){m.on("HERO_POSITION",this,t=>{this.centerPositionOnTarget(t.position)}),m.on("CHANGE_LEVEL",this,t=>{this.centerPositionOnTarget(t.heroStartPosition)})}centerPositionOnTarget(t){this.position=new r(-t.x+152,-t.y+82)}}const h={baseUrl:"Project-Kazamata",assetsPath:"assets",keys:{upKeys:["ArrowUp","KeyW"],downKeys:["ArrowDown","KeyS"],leftKeys:["ArrowLeft","KeyA"],rightKeys:["ArrowRight","KeyD"]},sizes:{gridSize:16,canvasWidth:320,canvasHeight:180}},S="LEFT",x="RIGHT",v="UP",E="DOWN";class q{constructor(){this.heldDirections=[],document.addEventListener("keydown",t=>{h.keys.upKeys.includes(t.code)?this.onKeyPressed(v):h.keys.downKeys.includes(t.code)?this.onKeyPressed(E):h.keys.leftKeys.includes(t.code)?this.onKeyPressed(S):h.keys.rightKeys.includes(t.code)&&this.onKeyPressed(x)}),document.addEventListener("keyup",t=>{h.keys.upKeys.includes(t.code)?this.onKeyReleased(v):h.keys.downKeys.includes(t.code)?this.onKeyReleased(E):h.keys.leftKeys.includes(t.code)?this.onKeyReleased(S):h.keys.rightKeys.includes(t.code)&&this.onKeyReleased(x)}),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("leftButton"),e=document.getElementById("rightButton"),s=document.getElementById("upButton"),n=document.getElementById("downButton"),o=(a,l)=>{a.addEventListener("mousedown",()=>this.onKeyPressed(l)),a.addEventListener("mouseup",()=>this.onKeyReleased(l)),a.addEventListener("touchstart",u=>{u.preventDefault(),this.onKeyPressed(l)}),a.addEventListener("touchend",u=>{u.preventDefault(),this.onKeyReleased(l)})};o(t,S),o(e,x),o(s,v),o(n,E)})}get direction(){return this.heldDirections[0]}onKeyPressed(t){this.heldDirections.includes(t)||this.heldDirections.unshift(t)}onKeyReleased(t){const e=this.heldDirections.indexOf(t);e>-1&&this.heldDirections.splice(e,1)}}class V{constructor(){this.toLoad={hero:"sprites/hero-sheet.png",shadow:"sprites/shadow.png",rod:"sprites/rod.png",exit:"sprites/exit.png",sky:"sprites/sky.png",ground:"sprites/ground.png",cave:"sprites/cave.png",caveGround:"sprites/cave-ground.png",knight:"sprites/knight-sheet-1.png",textBox:"sprites/text-box.png",fontWhite:"sprites/sprite-font-white.png"},this.images={};var t="";try{t="/"+h.baseUrl+"/"+h.assetsPath+"/"}catch(e){console.log(e),t="/"+h.baseUrl+"/"+h.assetsPath+"/"}console.log(`"${t}"`),Object.keys(this.toLoad).forEach(e=>{const s=new Image;s.src=t+this.toLoad[e],this.images[e]={image:s,isLoaded:!1},s.onload=()=>{this.images[e].isLoaded=!0}})}}const f=new V;class p extends w{constructor({resource:t,frameSize:e,hFrames:s,vFrames:n,frame:o,scale:a,position:l,animations:u}){super({position:l??new r(0,0)}),this.resource=t,this.frameSize=e??new r(h.sizes.gridSize,h.sizes.gridSize),this.hFrames=s??1,this.vFrames=n??1,this.frame=o??0,this.frameMap=new Map,this.scale=a??1,this.position=l??new r(0,0),this.animations=u??null,this.buildFrameMap()}buildFrameMap(){let t=0;for(let e=0;e<this.vFrames;e++)for(let s=0;s<this.hFrames;s++)this.frameMap.set(t,new r(s*this.frameSize.x,e*this.frameSize.y)),t++}step(t){this.animations&&(this.animations.step(t),this.frame=this.animations.frame)}drawImage(t,e,s){if(!this.resource.isLoaded)return;let n=0,o=0;const a=this.frameMap.get(this.frame);a&&(n=a.x,o=a.y);const l=this.frameSize.x,u=this.frameSize.y;t.drawImage(this.resource.image,n,o,l,u,e,s,l*this.scale,u*this.scale)}}class $ extends w{constructor(){super({position:new r(0,1)}),this.items=[],this.drawLayer="HUD",this.nextId=0,this.renderInventory()}renderInventory(){this.children.forEach(t=>t.destroy()),this.items.forEach((t,e)=>{const s=new p({resource:t.image,position:new r(e*12,0)});this.addChild(s)})}removeFromInventory(t){this.items=this.items.filter(e=>e.id!==t),this.renderInventory()}onInit(){m.on("HERO_PICK_UP_ITEM",this,t=>{this.items.push({id:this.nextId++,image:t.image}),console.log(this.items),this.renderInventory()})}}const J=5,c=new Map;c.set("c",4);c.set("f",5);c.set("i",2);c.set("j",4);c.set("l",3);c.set("n",4);c.set("r",4);c.set("t",4);c.set("u",4);c.set("v",4);c.set("x",4);c.set("y",4);c.set("z",4);c.set("E",4);c.set("F",4);c.set("M",7);c.set("W",7);c.set(" ",3);c.set("'",1);c.set("!",1);const Q=i=>c.get(i)??J,R=new Map;["abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ","0123456789 __",".!-,?'"].join("").split("").forEach((i,t)=>{R.set(i,t)});const Z=i=>R.get(i)??null,tt=5,et=1,st=3,it=20,nt=1,ot=1;class rt extends w{constructor(t){super({position:new r(32,108)});const e=t??"";this.drawLayer="HUD",this.words=e.split(" ").map(s=>{let n=0;const o=s.split("").map(a=>{const l=Q(a);return n+=l,{width:l,sprite:new p({resource:f.images.fontWhite,hFrames:13,vFrames:6,frame:Z(a)})}});return{wordWidth:n,chars:o}}),this.backdrop=new p({resource:f.images.textBox,frameSize:new r(256,64)}),this.showingIndex=0,this.textSpeed=it,this.timeUntilNextShow=this.textSpeed}step(t){this.timeUntilNextShow-=t,this.timeUntilNextShow<=0&&(this.showingIndex+=ot,this.timeUntilNextShow+=this.textSpeed)}drawImage(t,e,s){this.backdrop.drawImage(t,e,s);const n=7,o=7,a=240,l=14;let u=e+n,k=s+o,_=0;this.words.forEach(D=>{e+a-u<D.wordWidth&&(u=e+n,k+=l),D.chars.forEach(z=>{if(_>this.showingIndex)return;const{sprite:A,width:W}=z,U=u-tt;A.draw(t,U,k),u+=W+et,_+=nt}),u+=st})}}class at extends w{constructor(){super({}),this.level=null,this.input=new q,this.camera=new Y}onInit(){const t=new $;this.addChild(t);let e=null;e=new rt("Hallo mijn naam is Gamemeneer en in Minecraft bouw ik boten."),setTimeout(()=>{this.addChild(e)},500),m.on("CHANGE_LEVEL",this,s=>{this.setLevel(s)})}setLevel(t){this.level&&this.level.destroy(),this.level=t,this.addChild(this.level)}drawBackground(t){var e;(e=this.level)==null||e.background.drawImage(t,0,0)}drawObjects(t){this.children.forEach(e=>{e.drawLayer!=="HUD"&&e.draw(t,0,0)})}drawForeground(t){this.children.forEach(e=>{e.drawLayer==="HUD"&&e.draw(t,0,0)})}}class H extends w{constructor(){super({}),this.background=null,this.walls=new Set}}const d=i=>i*h.sizes.gridSize,ht=(i,t,e)=>{t=Math.round(t),e=Math.round(e);const s=`${t},${e}`;return!i.has(s)},b=(i,t)=>{const e=h.sizes.gridSize,s=Math.round(i/e)*e,n=Math.round(t/e)*e;return new r(s,n)};function dt(i,t,e){let s=t.x-i.position.x,n=t.y-i.position.y,o=Math.sqrt(s**2+n**2);if(o===0)return o;if(o<=e)return i.position.x=t.x,i.position.y=t.y,0;{Math.abs(s)<=e&&(i.position.x=t.x),Math.abs(n)<=e&&(i.position.y=t.y);let a=s/o,l=n/o;i.position.x+=a*e,i.position.y+=l*e,s=t.x-i.position.x,n=t.y-i.position.y,o=Math.sqrt(s**2+n**2)}return o}function N(i,t,e=void 0,s=1){t.x=Math.round(t.x),t.y=Math.round(t.y),e||(e=t);const n=Math.round(t.x),o=Math.round(t.y);return Math.abs(i.x-n)<=s&&Math.abs(i.y-o)<=s&&Math.abs(i.y-o)<=Math.abs(i.y-e.y)&&Math.abs(i.x-n)<=Math.abs(i.x-e.x)}class K extends w{constructor(t,e){super({position:new r(t,e)}),this.drawLayer="FLOOR",this.addChild(new p({resource:f.images.exit})),this.lastPlayerPosition=new r(0,0)}step(t,e){}onInit(){m.on("HERO_POSITION",this,t=>{N(this.position,t.position,this.lastPlayerPosition)&&m.emit("HERO_EXITS"),this.lastPlayerPosition=new r(t.position.x,t.position.y)})}}class ct{constructor(t){this.patterns=t,this.activeKey=Object.keys(t)[0]}get frame(){return this.patterns[this.activeKey].frame}play(t,e=0){this.activeKey!==t&&(this.activeKey=t,this.patterns[this.activeKey].currentTime=e)}step(t){this.patterns[this.activeKey].step(t)}}const L=(i=0)=>({duration:400,frames:[{time:0,frame:i+1}]}),C=(i=0)=>({duration:400,frames:[{time:0,frame:i+1},{time:100,frame:i},{time:200,frame:i+1},{time:300,frame:i+2}]}),lt=L(0),ut=L(3),mt=L(6),pt=L(9),ft=C(0),wt=C(3),gt=C(6),yt=C(9),It={duration:400,frames:[{time:0,frame:12}]};class g{constructor(t){this.currentTime=0,this.animationConfig=t,this.duration=t.duration}get frame(){const{frames:t}=this.animationConfig;for(let e=t.length-1;e>=0;e--)if(this.currentTime>=t[e].time)return t[e].frame;throw"Time is less than 0 in FrameIndexPattern"}step(t){this.currentTime+=t,this.currentTime=this.currentTime%this.duration}}class F extends w{constructor(t,e){super({position:new r(t,e)});const s=new p({resource:f.images.shadow,position:new r(-8,-19),frameSize:new r(32,32)});this.addChild(s),this.body=new p({resource:f.images.hero,hFrames:3,vFrames:8,frame:1,frameSize:new r(32,32),position:new r(-8,-20),animations:new ct({walkDown:new g(ft),walkUp:new g(gt),walkLeft:new g(yt),walkRight:new g(wt),standDown:new g(lt),standUp:new g(mt),standLeft:new g(pt),standRight:new g(ut),pickupDown:new g(It)})}),this.addChild(this.body),this.facingDirection=E,this.destinationPosition=this.position.duplicate(),this.itemPickupTime=0,this.itemPickupShell=null,m.on("HERO_PICK_UP_ITEM",this,n=>{this.onPickUpItem(n)})}step(t,e){if(this.itemPickupTime>0){this.workOnItemPickup(t);return}dt(this,this.destinationPosition,1)<=1&&this.tryMove(e),this.tryEmitPosition()}tryEmitPosition(){this.lastPosition&&this.lastPosition.x===this.position.x&&this.lastPosition.y===this.position.y||(m.emit("HERO_POSITION",{position:this.position,initialPosition:!this.lastPosition}),this.lastPosition=this.position.duplicate())}onPickUpItem({image:t,position:e}){const s=this.position.duplicate();this.position=b(s.x,s.y),this.destinationPosition=this.position.duplicate(),this.itemPickupTime=500,this.itemPickupShell=new w({}),this.itemPickupShell.addChild(new p({resource:t,position:new r(0,-18)})),this.addChild(this.itemPickupShell)}tryMove(t){const{input:e}=t;if(!e)return;if(!e.direction){this.facingDirection===S?this.body.animations.play("standLeft"):this.facingDirection===x?this.body.animations.play("standRight"):this.facingDirection===v?this.body.animations.play("standUp"):this.facingDirection===E&&this.body.animations.play("standDown");return}let s=this.destinationPosition.x,n=this.destinationPosition.y;s=Math.round(s),n=Math.round(n);const o=h.sizes.gridSize;e.direction===S?(s-=o,this.body.animations.play("walkLeft")):e.direction===x?(s+=o,this.body.animations.play("walkRight")):e.direction===v?(n-=o,this.body.animations.play("walkUp")):e.direction===E&&(n+=o,this.body.animations.play("walkDown")),this.facingDirection=e.direction??this.facingDirection,ht(t.level.walls,s,n)&&(this.parent.children.find(u=>u.isSolid&&u.position.x===s&&u.position.y===n)||(this.destinationPosition=b(s,n)))}workOnItemPickup(t){this.itemPickupTime-=t,this.body.animations.play("pickupDown"),this.itemPickupTime<=0&&(this.removeChild(this.itemPickupShell),this.itemPickupShell=null)}}class P extends w{constructor(t,e){super({position:new r(t,e)}),this.position=new r(t,e);const s=new p({resource:f.images.rod,position:new r(0,-2)});this.addChild(s)}onInit(){m.on("HERO_POSITION",this,t=>{N(this.position,t.position)&&this.onCollideWithHero()})}onCollideWithHero(){m.emit("HERO_PICK_UP_ITEM",{position:this.position,image:f.images.rod}),this.destroy()}}const Et=new r(d(8),d(4));class St extends H{constructor(t={}){super({}),this.background=new p({resource:f.images.cave,frameSize:new r(h.sizes.canvasWidth,h.sizes.canvasHeight)});const e=new p({resource:f.images.caveGround,frameSize:new r(h.sizes.canvasWidth,h.sizes.canvasHeight)});this.addChild(e);const s=new K(d(3),d(5));this.addChild(s);const n=new P(d(7),d(3));this.addChild(n),this.heroStartPosition=t.heroPosition??Et;const o=new F(this.heroStartPosition.x,this.heroStartPosition.y);this.addChild(o)}onInit(){m.on("HERO_EXITS",this,()=>{m.emit("CHANGE_LEVEL",new M({heroPosition:new r(d(11),d(6))}))})}}class xt extends w{constructor(t,e){super({position:new r(t,e)}),this.isSolid=!0;const s=new p({resource:f.images.shadow,frameSize:new r(32,32),position:new r(-8,-19)});this.addChild(s);const n=new p({resource:f.images.knight,frameSize:new r(32,32),hFrames:2,vFrames:1,position:new r(-8,-20)});this.addChild(n)}}const vt=new r(d(10),d(4));class M extends H{constructor(t={}){super({}),this.background=new p({resource:f.images.sky,frameSize:new r(h.sizes.canvasWidth,h.sizes.canvasHeight)});const e=new p({resource:f.images.ground,frameSize:new r(h.sizes.canvasWidth,h.sizes.canvasHeight)});this.addChild(e);const s=new K(d(10),d(6));this.addChild(s);const n=new P(d(11),d(3));this.addChild(n),this.addChild(new P(d(12),d(3))),this.addChild(new P(d(13),d(3)));const o=new xt(d(6),d(3));this.addChild(o),this.heroStartPosition=t.heroPosition??vt;const a=new F(this.heroStartPosition.x,this.heroStartPosition.y);this.addChild(a),this.walls.add("64,48"),this.walls.add("64,64"),this.walls.add("64,80"),this.walls.add("80,64"),this.walls.add("80,80"),this.walls.add("112,80"),this.walls.add("128,80"),this.walls.add("144,80"),this.walls.add("160,80")}onInit(){m.on("HERO_EXITS",this,()=>{m.emit("CHANGE_LEVEL",new St({heroPosition:new r(d(4),d(5))}))})}}const O=document.querySelector("#game-canvas"),I=O.getContext("2d"),y=new at({position:new r(0,0)});y.setLevel(new M);const Tt=i=>{y.stepEntry(i,y)},Pt=()=>{I.clearRect(0,0,O.width,O.height),y.drawBackground(I),I.save(),y.camera&&I.translate(y.camera.position.x,y.camera.position.y),y.drawObjects(I,0,0),I.restore(),y.drawForeground(I)},Lt=new X(Tt,Pt);Lt.start();
